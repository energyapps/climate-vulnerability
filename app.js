/*create array:*/
var marker = new Array();

//Create empty variable to store "this" DOM element in
var t;

function buildMap() {

//create empty array to push into
	var raw = [];

//create array of values
	var iconvalue = [];
if (t != undefined) {
//for each point, push if it is the right type and if that has been clicked
	for (var i = 0; i < geoJson[0].features.length; i++) {
		if (t.id === "b1" && geoJson[0].features[i].properties.cat === "inctemp") {
			raw.push(geoJson[0].features[i])
			iconvalue.push(geoJson[0].features[i].infomation);
		} 
		else if (t.id === "b2" && geoJson[0].features[i].properties.cat === "decwater") {
			raw.push(geoJson[0].features[i])
			iconvalue.push(geoJson[0].features[i].properties.information);
		}
		else if (t.id === "b3" && geoJson[0].features[i].properties.cat === "incstorm") {
			raw.push(geoJson[0].features[i])
			iconvalue.push(geoJson[0].features[i].properties.information);
		}
		else if (t.id === "b4") {
			raw.push(geoJson[0].features[i])
			iconvalue.push(geoJson[0].features[i].properties.information);
		}
		else if (t.id === "b5" && geoJson[0].features[i].properties.net_prem_1 != null) {
			raw.push(geoJson[0].features[i])
			iconvalue.push(geoJson[0].features[i].properties.information);
		}
		else if (t.id === "b6" && geoJson[0].features[i].properties.perc_sol_1 != null) {
			raw.push(geoJson[0].features[i])
			iconvalue.push(geoJson[0].features[i].properties.information);
		};
	};
} else {
	for (var i = 0; i < geoJson[0].features.length; i++) {
		//for the first load, load the first set of information
		if (geoJson[0].features[i].properties.cat != null) {
			raw.push(geoJson[0].features[i])
			iconvalue.push(geoJson[0].features[i].properties.information);
		};
	};
};
     


	for (var i = 0; i < raw.length; i++) {
	 //create a the "iconic" url for the icon, from the mapbox api.
	  var iconic;

	  if (raw[i].properties.icon === "nuke") {iconic = '/sites/prod/files/atom.png'} 
	  else if (raw[i].properties.icon === "fact") {iconic = '/sites/prod/files/fact.png'}
	  else if (raw[i].properties.icon === "grid") {iconic = '/sites/prod/files/grid.png'}
	  else if (raw[i].properties.icon === "hydro") {iconic = '/sites/prod/files/hydro.png'}
	  else if (raw[i].properties.icon === "pipe") {iconic = '/sites/prod/files/pipe.png'}
	  else if (raw[i].properties.icon === "well") {iconic = '/sites/prod/files/well.png'}
	  else if (raw[i].properties.icon === "solar") {iconic = '/sites/prod/files/solar.png'}	
	  else if (raw[i].properties.icon === "port") {iconic = '/sites/prod/files/port.png'}		  	
	  	;

	  // Create custom popup content
        var popupContent =  '<div><p>' + raw[i].properties.place + '</p><p>' + raw[i].properties.time + '</p><p>' + raw[i].properties.information + '</p></div>'; 

	  /*pushing items into array each by each and then add markers*/
	  var LamMarker = new L.marker([raw[i].geometry.coordinates[1],raw[i].geometry.coordinates[0]], {
	    icon: L.icon({
	        iconUrl: iconic,
	        iconSize:     [45, 45], // size of the icon
	        iconAnchor:   [22, 22], // point of the icon which will correspond to marker's location
	        popupAnchor:  [1, -23]  // point from which the popup should open relative to the iconAnchor
		    })
		}).bindPopup(popupContent, {closeButton:false });
		  marker.push(LamMarker);
		  map.addLayer(marker[i]);

	};
};

function removal() {
	for (var i = 0; i < marker.length; i++) {
    	map.removeLayer(marker[i]);
	};
	marker = [];
};

(function ($) {

	$(document).ready(function() { 
			buildMap();				


		$('.button').click(function (e) {
	      $('.button').removeClass('active');
	      $(this).addClass('active');
			removal();
			t = this;
			buildMap();
		});

	//turn on off pull tab
$('a#tably').click(function (e) {
       e.preventDefault();
       $('a#tably').removeClass('active');
       $('.about-data').addClass('active');
       $('a.closed').addClass('active');
   });

$('a.closed').click(function (e) {
       e.preventDefault();
       $('.about-data').removeClass('active');
       $('a.closed').removeClass('active');
       $('a#tably').addClass('active');
   });       
	});

}(jQuery));